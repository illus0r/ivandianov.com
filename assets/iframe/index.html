<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="ie=edge"><script id="fxhash-snippet">let alphabet="123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ";var fxhash="oo"+Array(49).fill(0).map((e=>alphabet[Math.random()*alphabet.length|0])).join("");let b58dec=e=>[...e].reduce(((e,a)=>e*alphabet.length+alphabet.indexOf(a)|0),0),fxhashTrunc=fxhash.slice(2),regex=new RegExp(".{"+(fxhashTrunc.length/4|0)+"}","g"),hashes=fxhashTrunc.match(regex).map((e=>b58dec(e))),sfc32=(e,a,h,r)=>()=>{var n=((e|=0)+(a|=0)|0)+(r|=0)|0;return r=r+1|0,e=a^a>>>9,a=(h|=0)+(h<<3)|0,h=(h=h<<21|h>>>11)+n|0,(n>>>0)/4294967296};var fxrand=sfc32(...hashes),isFxpreview="1"===new URLSearchParams(window.location.search).get("preview");function fxpreview(){console.log("fxhash: TRIGGER PREVIEW")}</script></head><body style="margin:0;font-family:monospace"> <canvas id="canvasgl" width="512" height="512" style="height:100vh;width:100vw;display:block"></canvas> <script>
function e(e,t,r){r=r||function(e){if(Array.isArray(e))if(Array.isArray(e[0]))switch(e[0].length){case 1:return"float[]";case 2:return"vec2[]";case 3:return"vec3[]";case 4:return"vec4[]"}else switch(e.length){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:return"float[]"}else{if("number"==typeof e)return"float";if("object"==typeof e&&"type"in e)return e.type}}(t);let n=function(e){switch(e){case"float":return(e,t,r)=>e.uniform1f(t,r);case"float[]":return(e,t,r)=>e.uniform1fv(t,r.flat());case"vec2":return(e,t,r)=>e.uniform2fv(t,r);case"vec4":return(e,t,r)=>e.uniform4fv(t,r);case"vec3[]":return(e,t,r)=>e.uniform3fv(t,r.flat());case"sampler2D":case"sampler3D":return(e,t,r)=>e.uniform1i(t,r.loc)}}(r),a={name:e,value:t,type:r,setGlUniform:n,set:e=>(a.value=e,a)};return a}function t(t,r,n){this.gl=t,void 0===n&&(n="#version 300 es\n\t\t\tin vec4 a_p;\n\t\t\tvoid main(){\n\t\t\t\t\tgl_Position = vec4(-1,-1,0,1);\n\t\t\t\t\tif(gl_VertexID==1)gl_Position = vec4(3,-1,0,1);\n\t\t\t\t\tif(gl_VertexID==2)gl_Position = vec4(-1,3,0,1);\n\t\t\t}"),void 0===r&&(r="#version 300 es\n\t\t\tprecision highp float;\n\t\t\tuniform sampler2D tx;\n\t\t\tuniform vec2 res;\n\t\t\tuniform float time;\n\t\t\tout vec4 o;\n\t\t\tvoid main(){\n\t\t\t\tvec2 uv = gl_FragCoord.xy/res;\n\t\t\t\to = texture(tx,fract(uv));\n\t\t\t\t// o.a=1.;\n\t\t\t}");let a=t.createShader(t.VERTEX_SHADER);t.shaderSource(a,n),t.compileShader(a);let i=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(i,r),t.compileShader(i);let o=t.createProgram();return t.attachShader(o,a),t.attachShader(o,i),t.linkProgram(o),o.draw=e=>{if(null==e)t.useProgram(o),t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,t.canvas.width,t.canvas.height),t.drawArrays(t.TRIANGLES,0,3);else if(Array.isArray(e)){let r=e;t.useProgram(o);let n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n);let a=r[0].w,i=r[0].h;r.forEach(((e,r)=>{t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+r,t.TEXTURE_2D,e,0)})),t.drawBuffers(r.map(((e,r)=>t.COLOR_ATTACHMENT0+r))),t.viewport(0,0,a,i),t.drawArrays(t.TRIANGLES,0,3),t.deleteFramebuffer(n)}else{t.useProgram(o);let r=e,n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0),t.viewport(0,0,r.w,r.h),t.drawArrays(t.TRIANGLES,0,3),t.deleteFramebuffer(n)}},o.setUf=e=>{t.useProgram(o);let r=t.getUniformLocation(o,e.name);e.setGlUniform(t,r,e.value)},o.ufs={},o.uf=r=>{t.useProgram(o);for(let n of Object.keys(r)){n in o.ufs?o.ufs[n].value=r[n]:o.ufs[n]=e(n,r[n]);let a=t.getUniformLocation(o,o.ufs[n].name);o.ufs[n].setGlUniform(t,a,o.ufs[n].value)}},o}let r=0;function n(e,t){let n,a,i=e.createTexture();return i.loc=r,void 0!==t&&(i.w=t.w||8,i.h=t.h||8,i.d=t.d||8,n=t.filter||e.NEAREST,i.bits=t.bits||32,i.type=t.type||"sampler2D",a=t.pixels?t.pixels:null,Number.isInteger(t.loc)&&(i.loc=t.loc)),a&&(32==i.bits?a=new Float32Array(a):8==i.bits&&(a=new Uint8Array(a))),e.activeTexture(e.TEXTURE0+i.loc),"sampler2D"==i.type?(e.bindTexture(e.TEXTURE_2D,i),32==i.bits?e.texImage2D(e.TEXTURE_2D,0,e.RGBA32F,i.w,i.h,0,e.RGBA,e.FLOAT,a):8==i.bits&&e.texImage2D(e.TEXTURE_2D,0,e.RGBA,i.w,i.h,0,e.RGBA,e.UNSIGNED_BYTE,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n),e.generateMipmap(e.TEXTURE_2D)):"sampler3D"==i.type&&(e.bindTexture(e.TEXTURE_3D,i),e.texImage3D(e.TEXTURE_3D,0,e.RGBA32F,i.w,i.h,i.d,0,e.RGBA,e.FLOAT,a),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_MIN_FILTER,n),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_MAG_FILTER,n),e.generateMipmap(e.TEXTURE_3D),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_WRAP_S,e.GL_MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_WRAP_T,e.GL_MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_WRAP_R,e.GL_MIRRORED_REPEAT)),void 0!==t.src&&(i.image=new Image,i.image.src=t.src,i.image.addEventListener("load",(function(t){i.w=t.srcElement.width,i.h=t.srcElement.height,e.activeTexture(e.TEXTURE0+i.loc),e.bindTexture(e.TEXTURE_2D,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i.image),e.generateMipmap(e.TEXTURE_2D)}))),r++,i.generateMipmap=()=>{e.activeTexture(e.TEXTURE0+i.loc),e.bindTexture(e.TEXTURE_2D,i),e.generateMipmap(e.TEXTURE_2D)},i}let a=(e,t,r,n)=>{let a=e.canvas;void 0===n&&(n=devicePixelRatio),void 0===t&&(t=a.clientWidth*n),void 0===r&&(r=a.clientHeight*n);if(a.width!==t||a.height!==r)return a.width=t,a.height=r,e.viewport(0,0,e.canvas.width,e.canvas.height),[t,r]},i=!0,o=[...Array(4)].map((e=>[fxrand()])),s=[.5,.5],u=["#000001","#1D2B52","#7E2552","#008750","#AB5235","#5F574E","#C2C3C8","#FFF1E7","#FF014D","#FFA300","#FFEC28","#01E435","#30ADFF","#83769D","#FF77A7","#FFCCAB"].sort((e=>fxrand()-.5)).slice(0,5);u=u.map((e=>e=(e=e.slice(1)).match(/(.{2})/g).map((e=>Number("0x"+e)/255)))),console.log("palette:",u);let c=new function(e){let t=document.querySelector(e).getContext("webgl2",{preserveDrawingBuffer:!0});return t.getExtension("EXT_color_buffer_float"),t.getExtension("OES_texture_float_linear"),t}("canvas"),l=new t(c,"#version 300 es\nprecision highp float;\nuniform sampler2D tx;\nuniform sampler2D tx_rul;\nuniform float frame;\nuniform float pass;\nuniform float time;\nuniform vec2 res;\nuniform vec2 mouse;\nuniform float rndjs[4];\nout vec4 o;\n\n#define c(r,i) mat2(r,i,-(i),r)\n#define c2(v) mat2(v,-(v).y,(v).x)\n#define rot(a) mat2(cos(a),-sin(a),sin(a),cos(a))\n\nfloat noise(vec2 uv){\n\tuv = abs(mod(uv,2.)-1.)-.5;\n\tmat2 z = c2(uv);\n\tmat2 a = c(-0.696, 0.136);\n\tfloat i;\n\tfor(i=0.;i<5.;i++){\n\t\tz = inverse(z*z+a);\n\t}\n\tuv = z[0];\n\tuv = fract(uv-.5+time*.1)-.5;\n\treturn length(uv)*sqrt(2.);\n}\n\nvoid main(){\n\tvec2 uv = (gl_FragCoord.xy*2.-res)/res.y*1.;\n\n\tvec2 uvI = uv;\n\tvec3 n;\n\tn.x = noise(uv)-.5;\n\tn.y = noise(uv*rot(3.14/4.))-.5;\n\t/* n.y = noise(uv+.1)-.5; */\n\tn.z = .2;\n\tn = normalize(n);\n\n\tvec3 l = normalize(vec3(0,.2,.5));\n\to.rgb+=pow(max(dot(n, l),0.),200.);\n\to.rgb+=pow(max(dot(n, l),0.),2.)*.5;\n\t/* o+=sin(o.r*80.)*.1; */\n\n\to.a=1.;\n\treturn;\n\n\tfloat j,d,E=1.;\n\tvec3 p;\n\tfor(;j++<99.&&E>1e-3;){\n\t\tp=normalize(vec3(uv,1))*d;\n\t\tp.z-=time+uvI.x*.1;\n\t\tp=fract(p)-.5;\n\t\td+=E=length(p)-.4;\n\t}\n\to=vec4(3./j);\n\n\to.a=1.;\n}"),f=new t(c),E=[];window.addEventListener("resize",(function(){E.length>0&&E.forEach((e=>c.deleteTexture(e)));let[e,t]=[innerWidth,innerHeight];a(c,e,t),E=[0,0].map(((r,a)=>new n(c,{w:e,h:t,loc:a,filter:c.LINEAR_MIPMAP_LINEAR})))}),!0),window.dispatchEvent(new Event("resize")),window.addEventListener("mousemove",(e=>{let[t,r]=[c.canvas.width,c.canvas.height];s=[e.clientX/t*2-1,2*(1-e.clientY/r)-1],console.log("mouse:",s)}));let m=+new Date,T=m,v=m,d=0;!function e(){T=v,v=+new Date;let t=(v-m)/1e3;if(d++,i&&E.length>0){for(let e=0;e<10;e++)E[0].generateMipmap(),E[1].generateMipmap(),l.uf({time:t,res:[E[0].w,E[0].h],tx:E[0],frame:d,mouse:s,rndjs:o,palette:u}),l.draw(E[1]),E.reverse();f.uf({time:t,res:[E[0].w,E[0].h],tx:E[0],frame:d,rndjs:o}),f.draw()}else m+=v-T;requestAnimationFrame(e)}(),document.addEventListener("keydown",(e=>{"Space"!==e.code||(i=!i)}),!1),document.addEventListener("keydown",(e=>"KeyS"==e.code?function(e){let t=document.createElement("a");t.setAttribute("download",`${fxhash}.png`),document.querySelector("canvas").toBlob((function(e){let r=URL.createObjectURL(e);t.setAttribute("href",r),t.click()}))}():0));
</script> </body></html>
