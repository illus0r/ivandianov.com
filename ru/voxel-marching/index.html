<!DOCTYPE html><html class=""><head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Воксельный реймаршинг · Ivan Dianov</title>
    <link rel="stylesheet" href="/styles.css">
    <!-- FIXME check if it is needed -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.css">
    <link id="favicon" rel="icon">
<script>
		let w = 3
		let h = 5
    let svg = `<svg width="128" height="128" xmlns="http://www.w3.org/2000/svg" viewBox="1 0 ${w*2} ${h}"	>`
		for(let x = 0; x < w; x++) {
			for(let y = 0; y < h; y++) {
				let color = Math.random() > 0.5 ? "#000" : "#fff"
				svg += `<rect x="${w-x}" y="${y}" width="1" height="1" fill="${color}"/>`
				svg += `<rect x="${w+x}" y="${y}" width="1" height="1" fill="${color}"/>`
			}
		}

    svg+=`</svg>`
console.log('svg:',svg)

    document.getElementById("favicon").setAttribute("href", `data:image/svg+xml,${encodeURIComponent(svg)}`)
</script>

    <!-- Yandex.Metrika counter -->
<script type="text/javascript">
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(94453443, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true
   });
</script>
<noscript></noscript></head><body><div><img src="/.11ty/image/?src=https%3A%2F%2Fmc.yandex.ru%2Fwatch%2F94453443&amp;width=1&amp;format=webp&amp;via=transform" style="position:absolute; left:-9999px;" alt="" loading="lazy" decoding="async" width="1" height="1"></div>
<!-- /Yandex.Metrika counter -->




    <header>
  <div class="nav-menu">
    
    
    
        <a class="nav-item" href="/">
          Иван Дианов
        </a>
    
      
        
        
        <a class="nav-item" href="/">
          Дизайн
        </a>
        
      
    
      
        
        
        <a class="nav-item" href="/ru/show/">
          Медиа-арт
        </a>
        
      
    
      
        
        
        <a class="nav-item" href="/ru/tutor/">
          Обучение
        </a>
        
      
    
      
        
        
        <a class="nav-item" href="/ru/about/">
          Про меня
        </a>
        
      
    
    
    
    
    
    
		
      
		
        
		
      
		
    
    
		
      
		
      
		
  </div>
</header>


    <main role="main" class="wrap prose">
        
<article class="text" role="main">
    <div class="post-header">
		<div class="meta">
    
		
	
	


<span class="progress" style="--progress: 90deg;"></span> Черновик

    </div>
    <h1 class="post-name"><span class="dance-dance"><span>В</span><span>о</span><span>к</span><span>с</span><span>е</span><span>л</span><span>ь</span><span>н</span><span>ы</span><span>й</span><span> </span><span>р</span><span>е</span><span>й</span><span>м</span><span>а</span><span>р</span><span>ш</span><span>и</span><span>н</span><span>г</span></span></h1>
    </div>
    <section class="post-content">
        <p>План того, что тут будет появляться:</p>
<ul>
<li>Классический воксель-маршинг</li>
<li>Гибридный, с СДФ внутри вокселей</li>
<li>Ускорение с помощью мипмэпа</li>
<li>Ускорение с помощью джамп-флуда</li>
</ul>
<p>Предполагаю, что вы уже знакомы с алгоритмом реймаршинга, если нет, <a href="https://www.youtube.com/watch?v=PGtv-dBi2wE">посмотрите видео</a></p>
<h2><span class="dance-dance"><span>К</span><span>л</span><span>а</span><span>с</span><span>с</span><span>и</span><span>ч</span><span>е</span><span>с</span><span>к</span><span>и</span><span>й</span><span> </span><span>в</span><span>о</span><span>к</span><span>с</span><span>е</span><span>л</span><span>ь</span><span>-</span><span>м</span><span>а</span><span>р</span><span>ш</span><span>и</span><span>н</span><span>г</span></span></h2>
<p>В отличие от реймаршинга, в котором длина шага зависит от расстояния до ближайшего объекта, тут пространство делится на кубические ячейки, как тетрадь в клетку. И каждый шаг вдоль луча происходит от вокселя к вокселю. Шагнув в воксель мы проверяем, полный он или пустой. И если полный — останавливаемся, мы уткнулись в объект, можно дальше не маршировать.</p>
<p>Чтобы разобраться, как работает трёхмерный воксель-маршинг, лучше начать с двумерного. А круче всего — вообще с одномерного.</p>
<p>Вот оно, наше двумерное пространство. Мы пустим луч из точки 0, пусть камера будет там. Луч полетит вправо, будет лететь, пока не найдёт заполненный <s>воксель</s> отрезок.</p>
<iframe src="https://editor.p5js.org/illus0r/full/_Ln1BsDwd" width="400" height="444"></iframe>
<p :="" class="caption">Недописанный скетч для 2д случая</p>
<h2><span class="dance-dance"><span>У</span><span>с</span><span>к</span><span>о</span><span>р</span><span>е</span><span>н</span><span>и</span><span>е</span><span> </span><span>с</span><span> </span><span>п</span><span>о</span><span>м</span><span>о</span><span>щ</span><span>ь</span><span>ю</span><span> </span><span>S</span><span>D</span><span>F</span><span>-</span><span>т</span><span>е</span><span>к</span><span>с</span><span>т</span><span>у</span><span>р</span><span>ы</span></span></h2>
<p>Более простой и, кажется, более надёжный способ — заранее сделать карту вокселей. Каждый пустой воксель в ней будет знать расстояние до ближайшего не пустого.</p>
<p>Посчитать можно с помощью <a href="https://t.me/ivandianov/487">джамп-флудинга</a>.</p>
<p>Если раньше мы двигались по лучу не дальше, чем на один воксель, теперь можем проверять SDF текстуру и, если до ближайшего вокселя далеко, шагать смелее.</p>
<p>Например, у этой картинки</p>
<p><img src="/.11ty/image/?src=assets%2Fmedia%2F2023-02-23-20-25-01.jpg&amp;width=512&amp;format=webp&amp;via=transform" alt="" loading="lazy" decoding="async" width="1024" height="1024" srcset="/.11ty/image/?src=assets%2Fmedia%2F2023-02-23-20-25-01.jpg&amp;width=512&amp;format=webp&amp;via=transform 512w, /.11ty/image/?src=assets%2Fmedia%2F2023-02-23-20-25-01.jpg&amp;width=1024&amp;format=webp&amp;via=transform 1024w" sizes="auto"></p>
<p>вот такой СДФ:</p>
<p><video controls="" muted="" loop="" autoplay=""><source src="/assets/media/voxel-marching-sdf.mp4" type="video/mp4"></video></p>
<p>На самом деле я использую 2д текстуру для его хранения. Чтобы это получилось, я разрезаю объёмную карту на горизонтальные слои в один воксель и кладу их слева направо. Получается текстура высотой voxSize и шириной voxSize²</p>
<p :="" class="caption"><img src="/.11ty/image/?src=assets%2Fmedia%2F2023-02-23-21-02-58.png&amp;width=512&amp;format=webp&amp;via=transform" alt="" loading="lazy" decoding="async" width="2048" height="8" srcset="/.11ty/image/?src=assets%2Fmedia%2F2023-02-23-21-02-58.png&amp;width=512&amp;format=webp&amp;via=transform 512w, /.11ty/image/?src=assets%2Fmedia%2F2023-02-23-21-02-58.png&amp;width=1024&amp;format=webp&amp;via=transform 1024w, /.11ty/image/?src=assets%2Fmedia%2F2023-02-23-21-02-58.png&amp;width=2048&amp;format=webp&amp;via=transform 2048w" sizes="auto">
Это не <code>&lt;hr&gt;</code>, это узкая картинка</p>
<p>Как видите, вы почти ничего не видите. Слишком мелко. Если призумить кусочек, будет так:</p>
<p><img src="/.11ty/image/?src=assets%2Fmedia%2F2023-02-23-21-04-28.png&amp;width=512&amp;format=webp&amp;via=transform" alt="" loading="lazy" decoding="async" width="2048" height="111" srcset="/.11ty/image/?src=assets%2Fmedia%2F2023-02-23-21-04-28.png&amp;width=512&amp;format=webp&amp;via=transform 512w, /.11ty/image/?src=assets%2Fmedia%2F2023-02-23-21-04-28.png&amp;width=1024&amp;format=webp&amp;via=transform 1024w, /.11ty/image/?src=assets%2Fmedia%2F2023-02-23-21-04-28.png&amp;width=2048&amp;format=webp&amp;via=transform 2048w" sizes="auto"></p>

    </section>
</article>

<script src="https://utteranc.es/client.js" repo="illus0r/ivandianov.com" issue-term="pathname" label="blog-comment" theme="github-light" crossorigin="anonymous" async="">
</script>

    </main>

    <footer>
  <section class="copyright">© <a href="/">Иван Дианов</a> 2021—∞ ·
		<a href="/ru/blog/">Блог</a> ·
		<a href="https://t.me/ivandianov">Канал в телеге</a> про генеративный арт, алгоритмы и жизнь</section>
</footer>


    <script src="/assets/js/dance-dance.js" type="module"></script>
    


</body></html>